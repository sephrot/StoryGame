@using StoryGame.Models
@using StoryGame.Models.ViewModels
@model WorkspaceViewModel

@{
  Layout = null;
  var currentId = Model.Selected?.StoryId;
}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Story Workspace</title>

  <link rel="stylesheet" href="~/css/create.css" asp-append-version="true" />
</head>

<body class="bg-stars">
  <div class="workspace">
    <!-- LEFT: Sidebar -->
    <aside class="sidebar" aria-label="Stories navigation">
      <header class="side-head">
        <h1 class="app-title">Story Lab</h1>
        <p class="muted">Pixel writer‚Äôs desk</p>
        <div class="side-actions">
          <!-- Force a clean /Story/Create (no id) -->
          <a class="btn btn-accent btn-block" asp-controller="Story" asp-action="Create" asp-route-id="">
            + Create Story
          </a>

          <a class="btn btn-ghost btn-block" asp-controller="Story" asp-action="TableStory">
            ‚Üê Back
          </a>
        </div>


      </header>

      <div class="side-section">
        <h2 class="section-title">My Stories</h2>
        @await Html.PartialAsync(
        "~/Views/Shared/_SidebarStories.cshtml",
                new Tuple<IEnumerable<Story>, int?>(Model.Stories, currentId)
                )
      </div>
    </aside>

    <main class="editor">

      <div id="editor-surface" class="editor-surface" data-story-id="@currentId">
        <div id="workspace-modal" hidden></div>

        @if (Model.Selected is null)
        {
          <div class="empty-state">
            <h2>No story selected</h2>
            <p>Select a story on the left or create a new one.</p>
          </div>
        }
        else
        {
          <h2>@Model.Selected.Text</h2>

          @* INLINE scene list with Edit buttons *@
          @if (Model.Selected?.ScenesList != null && Model.Selected.ScenesList.Any())
          {
            <div class="scenes-stack">
              @foreach (var sc in Model.Selected.ScenesList)
              {
                <div class="scene-chip" style="display:flex;align-items:center;justify-content:space-between;gap:8px;">
                  <span>@sc.Text</span>
                  <div class="scene-actions">
                    <button type="button" class="btn btn-accent btn-xs js-edit-scene" data-id="@sc.SceneId">
                      ‚úèÔ∏è Edit
                    </button>
                    <button type="button" class="btn btn-danger btn-xs js-delete-scene" data-id="@sc.SceneId">
                      üóë Delete
                    </button>
                  </div>
                </div>
              }
            </div>
          }
          else
          {
            <em>No scenes yet.</em>
          }

        }
      </div>
    </main>
  </div>


  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/jquery-validation-unobtrusive@3.2.13/dist/jquery.validate.unobtrusive.min.js"></script>


  <script src="~/js/workspace.js" asp-append-version="true"></script>
</body>

</html>